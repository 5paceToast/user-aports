# Contributor: Chloe Kudryavtsev <toast@toastin.space>
# Maintainer: Chloe Kudryavtsev <toast@toastin.space>
pkgname=exa
pkgver=0.8.0
pkgrel=0
pkgdesc="A modern version of 'ls'"
url="https://the.exa.website/"
arch="all"
license="MIT"
depends=""
makedepends="cargo cmake"
install=""
subpackages="
	$pkgname-doc
	$pkgname-bash-completion:bash:noarch
	$pkgname-fish-completion:fish:noarch
	$pkgname-zsh-completion:zsh:noarch
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/ogham/exa/archive/v$pkgver.tar.gz"
builddir="$srcdir/exa-$pkgver"

export CARGO_HOME="$srcdir/cargo"
export RUSTFLAGS="-C target-feature=-crt-static"

build() {
	cd "$builddir"
	cargo build \
		--release \
		--verbose
}

check() {
	cd "$builddir"
	cargo test --all \
		--release \
		--verbose
}

package() {
	cd "$builddir"
	install -m755 -D target/release/exa "$pkgdir/usr/bin/exa"
	install -m644 -D contrib/man/exa.1 "$pkgdir/usr/share/man/man1/exa.1"

	install -m644 -D contrib/completions.bash \
		"$pkgdir/usr/share/bash-completions/completions/exa"
	install -m644 -D contrib/completions.fish \
		"$pkgdir/usr/share/fish/completions/exa.fish"
	install -m644 -D contrib/completions.zsh \
		"$pkgdir/usr/share/zsh/site-functions/_exa"
}

bash() {
	mkdir -p "$subpkgdir/usr/share"
	mv "$pkgdir/usr/share/bash-completions" "$subpkgdir/usr/share/"
}

fish() {
	mkdir -p "$subpkgdir/usr/share"
	mv "$pkgdir/usr/share/fish" "$subpkgdir/usr/share/"
}

zsh() {
	mkdir -p "$subpkgdir/usr/share"
	mv "$pkgdir/usr/share/zsh" "$subpkgdir/usr/share/"
}

sha512sums="5ac142f40af8408e03e7fa7b204216182ad696e44c1d044bd73d04957a638a8ed7295c15fc49279165b5dfb2d8b6a559847930de0e267f479cdab88fe9c49beb  exa-0.8.0.tar.gz"
